<!-- frontend/html-css/signup.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Login / Signup</title>
  <link rel="stylesheet" href="css/styles.css" />
  <style>
    body {
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background-color: #f0f2f5;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    .auth-container {
      background: #fff;
      padding: 30px 40px;
      border-radius: 12px;
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
      width: 100%;
      max-width: 400px;
    }

    h2#auth-title {
      text-align: center;
      margin-bottom: 25px;
    }

    form#auth-form input {
      width: 100%;
      padding: 10px 12px;
      margin-bottom: 15px;
      border-radius: 6px;
      border: 1px solid #ccc;
      box-sizing: border-box;
      font-size: 16px;
    }

    form#auth-form button {
      width: 100%;
      padding: 12px;
      background-color: #00bfff;
      color: white;
      font-weight: bold;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
    }

    form#auth-form button:hover {
      background-color: #009acd;
    }

    .auth-toggle {
      margin-top: 15px;
      text-align: center;
      color: #555;
      font-size: 14px;
      cursor: pointer;
    }

    .auth-toggle:hover {
      text-decoration: underline;
    }

    #forgot-password-link a:hover {
      color: #009acd;
      text-decoration: underline;
    }
  </style>
  <script src="js/config.js"></script>
</head>
<body>
  <div class="auth-container">
    <h2 id="auth-title">Sign Up</h2>
    <form id="auth-form">
      <div id="name-group">
        <input type="text" id="name" placeholder="Full Name" />
      </div>
      <input type="email" id="email" placeholder="Email" required />
      <input type="password" id="password" placeholder="Password" required />
      <button type="submit">Sign Up</button>
    </form>
    <div id="forgot-password-link" style="text-align: center; margin-top: 10px; display: none;">
      <a href="#" onclick="handleForgotPassword(); return false;" style="color: #00bfff; text-decoration: none; font-size: 14px;">Forgot Password?</a>
    </div>
    <div class="auth-toggle" onclick="toggleAuth()">Already have an account? Login</div>
  </div>

  <script>
    let isSignup = true;

    function toggleAuth(forceMode = null) {
      const title = document.getElementById("auth-title");
      const button = document.querySelector("#auth-form button");
      const toggleText = document.querySelector(".auth-toggle");
      const nameGroup = document.getElementById("name-group");
      const forgotPasswordLink = document.getElementById("forgot-password-link");

      if (forceMode === "login" || (!forceMode && isSignup)) {
        isSignup = false;
        title.innerText = "Login";
        button.innerText = "Login";
        toggleText.innerText = "Don't have an account? Sign Up";
        nameGroup.style.display = "none";
        if (forgotPasswordLink) forgotPasswordLink.style.display = "block";
      } else {
        isSignup = true;
        title.innerText = "Sign Up";
        button.innerText = "Sign Up";
        toggleText.innerText = "Already have an account? Login";
        nameGroup.style.display = "block";
        if (forgotPasswordLink) forgotPasswordLink.style.display = "none";
      }
    }

    async function handleForgotPassword() {
      const email = document.getElementById("email").value;
      if (!email) {
        alert("Please enter your email address first.");
        return;
      }

      try {
        const res = await fetch('http://localhost:5000/api/auth/forgot-password', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email })
        });

        const data = await res.json();

        if (res.ok) {
          alert("✅ " + data.message);
        } else {
          alert("❌ " + (data.message || "Failed to send reset email."));
        }
      } catch (err) {
        console.error("Forgot password error:", err);
        alert("❌ Server error. Please try again later.");
      }
    }

    // Auto-detect mode from URL
    window.addEventListener("DOMContentLoaded", () => {
      const params = new URLSearchParams(window.location.search);
      if (params.get("mode") === "login") {
        toggleAuth("login");
      }
    });

    document.getElementById("auth-form").addEventListener("submit", async (e) => {
      e.preventDefault();

      const name = document.getElementById("name")?.value;
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;

      const url = isSignup
        ? "http://localhost:5000/api/auth/signup"
        : "http://localhost:5000/api/auth/login";

      const payload = isSignup ? { name, email, password } : { email, password };

      try {
        const res = await fetch(url, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload),
        });

        const data = await res.json();
        if (!res.ok) {
          alert(data.message || "Something went wrong ");
          return;
        }

        if (isSignup) {
          // After signup → go to profile setup
          alert("Signup successful Please fill your profile next.");
          localStorage.setItem("email", email);
          localStorage.setItem("tempPassword", password); 
          window.location.href = "profile-setup.html";
        } else {
          // Login success
          alert("Login successful ");
          localStorage.setItem("email", email);

          // Save doctor profile returned from backend directly
          if (data.doctorProfile) {
            localStorage.setItem("doctorProfile", JSON.stringify(data.doctorProfile));
          }

          //  Redirect to doctor dashboard
          window.location.href = "index.html";
        }
      } catch (err) {
        console.error(err);
        alert("Server error ");
      }
    });
  </script>
</body>
</html>
